<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${movie.movieName} + ' - Movie Details'">Movie Details</title>
    <link rel="stylesheet" th:href="@{/css/movie-details.css}">
</head>
<body>
    <div class="container">
        <div class="movie-details">
            <div class="movie-header">
                <div class="movie-icon" th:text="${movieIcon}">üé¨</div>
                <h1 class="movie-title" th:text="${movie.movieName}">Movie Title</h1>
            </div>
            
            <div class="movie-info">
                <div class="info-item">
                    <span class="info-label">Director</span>
                    <span class="info-value" th:text="${movie.director}">Director</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Year</span>
                    <span class="info-value" th:text="${movie.year}">Year</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Genre</span>
                    <span class="info-value" th:text="${movie.genre}">Genre</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Duration</span>
                    <span class="info-value" th:text="${movie.duration} + ' minutes'">Duration</span>
                </div>
            </div>
            
            <div class="rating-section">
                <h3>Rating</h3>
                <div>
                    <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                    <span class="rating-score" th:text="${#numbers.formatDecimal(movie.imdbRating, 1, 1)} + '/5'">5.0/5</span>
                </div>
            </div>
            
            <div class="description">
                <h3>Description</h3>
                <p th:text="${movie.description}">Movie description</p>
            </div>
            
            <div class="reviews-section" th:if="${not #lists.isEmpty(allReviews)}">
                <div class="reviews-header">
                    <h3>Customer Reviews</h3>
                    <button class="add-review-btn" onclick="openReviewModal()">Add Review</button>
                </div>
                <div class="review" th:each="review : ${allReviews}">
                    <div class="review-header">
                        <div class="review-avatar" th:text="${review.avatarEmoji}">üë®</div>
                        <div class="review-user" th:text="${review.userName}">User</div>
                        <div class="review-rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span th:text="${#numbers.formatDecimal(review.rating, 1, 1)}">5.0</span></div>
                    </div>
                    <div class="review-comment" th:text="${review.comment}">Review comment</div>
                </div>
            </div>
            
            <a th:href="@{/movies}" class="back-button">‚Üê Back to Movies</a>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReviewModal()">&times;</span>
            <h3>Add Your Review</h3>
            <div th:if="${error}" class="error-message" th:text="${error}">Error message</div>
            <form method="POST" th:action="@{/movies/{id}/details(id=${movie.id})}" class="review-form" onsubmit="return validateForm()">
                <div class="form-group">
                    <label for="userName">Your Name:</label>
                    <input type="text" id="userName" name="userName" th:value="${storedUserName}" required minlength="2" maxlength="50" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label>Rating:</label>
                    <div class="star-rating">
                        <span class="star" data-rating="1">‚òÜ</span>
                        <span class="star" data-rating="2">‚òÜ</span>
                        <span class="star" data-rating="3">‚òÜ</span>
                        <span class="star" data-rating="4">‚òÜ</span>
                        <span class="star" data-rating="5">‚òÜ</span>
                    </div>
                    <input type="hidden" id="rating" name="rating">
                </div>
                <div class="form-group">
                    <label for="comment">Your Review:</label>
                    <textarea id="comment" name="comment" required maxlength="500" rows="4" placeholder="Share your thoughts about this movie (minimum 5 words)..."></textarea>
                </div>
                <button type="submit" class="submit-button">Submit Review</button>
            </form>
        </div>
    </div>
    
    <script th:src="@{/js/modal.js}"></script>
    <script th:if="${error}">
        // Auto-open modal if there's an error
        document.addEventListener('DOMContentLoaded', function() {
            openReviewModal();
        });
    </script>
</body>
</html>
